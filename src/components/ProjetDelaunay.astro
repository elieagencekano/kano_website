---
---

<section class="projet-delaunay" aria-label="Projet Domaine Delaunay">
  <div class="container">
    <div class="cards-wrapper">
      <div class="main-card">
        <div class="card-inner">
          <div class="card-front">
            <img src={`${import.meta.env.BASE_URL}grappe-de-raisin-domaine-DELAUNAY-scaled.webp`} alt="Domaine Delaunay - Grappe de raisin" />
            <div class="card-overlay">
              <h2>Domaine DELAUNAY</h2>
            </div>
          </div>
          <div class="card-back">
            <img src={`${import.meta.env.BASE_URL}mockupdelaunay.webp`} alt="Domaine Delaunay - Mockup" />
          </div>
        </div>
      </div>
      
      <div class="small-cards">
        <div class="small-card small-card-1">
          <img src={`${import.meta.env.BASE_URL}degustation-vin-blanc-anjou-didier-delaunay (1).webp`} alt="Domaine Delaunay - Vin blanc" />
        </div>
        <div class="small-card small-card-2">
          <img src={`${import.meta.env.BASE_URL}degustation-vin-anjou-didier-delaunay (1).webp`} alt="Domaine Delaunay - DÃ©gustation" />
        </div>
      </div>
    </div>
  </div>
</section>

<style>
.projet-delaunay{position:relative;min-height:120vh;padding:60px 0}
.container{max-width:1000px;margin:0 auto;padding:0 32px;position:sticky;top:80px}
.cards-wrapper{position:relative;perspective:1500px}
.main-card{width:100%;aspect-ratio:16/10;position:relative;transform-style:preserve-3d}
.card-inner{position:relative;width:100%;height:100%;transform-style:preserve-3d;will-change:transform}
.card-front,.card-back{position:absolute;inset:0;backface-visibility:hidden;border-radius:20px;overflow:hidden;box-shadow:0 20px 60px rgba(0,0,0,.4)}
.card-front img,.card-back img{width:100%;height:100%;object-fit:cover}
.card-back{transform:rotateY(180deg)}
.card-overlay{position:absolute;inset:0;display:flex;align-items:center;justify-content:center;background:rgba(0,0,0,.4);backdrop-filter:blur(2px)}
.card-overlay h2{font-family:Montserrat,sans-serif;font-size:clamp(1.8rem,4vw,3rem);font-weight:900;color:#fff;text-align:center;text-shadow:0 4px 20px rgba(0,0,0,.5)}
.small-cards{display:grid;grid-template-columns:1fr 1fr;gap:20px;margin-top:20px;opacity:0;transform:translateY(-200px);z-index:-1;position:relative;will-change:transform,opacity;transition:none}
.small-card{border-radius:16px;overflow:hidden;box-shadow:0 15px 40px rgba(0,0,0,.3);aspect-ratio:4/3}
.small-card img{width:100%;height:100%;object-fit:cover}
.main-card.flipped .card-inner{transform:rotateY(180deg)}
.small-cards.revealed{opacity:1;transform:translateY(0)}

@media (max-width:768px){
  .projet-delaunay{padding:40px 0}
  .container{padding:0 20px;top:80px}
  .small-cards{gap:12px;margin-top:12px}
  .card-overlay h2{font-size:1.5rem}
}
@media (max-width:480px){
  .container{top:70px}
  .card-overlay h2{font-size:1.3rem}
}
</style>

<script>
document.addEventListener('DOMContentLoaded', () => {
  const section = document.querySelector('.projet-delaunay');
  const cardInner = section ? section.querySelector('.card-inner') : null;
  const smallCards = section ? section.querySelector('.small-cards') : null;

  if (!section || !cardInner || !smallCards) return;

  let viewportHeight = window.innerHeight;
  let viewportWidth = window.innerWidth;
  let isMobile = viewportWidth <= 1024;
  let sectionOffsetTop = section.offsetTop;

  const onResize = () => {
    viewportHeight = window.innerHeight;
    viewportWidth = window.innerWidth;
    isMobile = viewportWidth <= 1024;
    sectionOffsetTop = section.offsetTop;
  };

  window.addEventListener('resize', onResize);

  let targetScroll = window.scrollY || window.pageYOffset || 0;
  let virtualScroll = targetScroll;

  const easeInOutCubic = t => t < 0.5 ? 4 * t * t * t : 1 - Math.pow(-2 * t + 2, 3) / 2;
  const clamp01 = v => Math.max(0, Math.min(1, v));

  const updateWithScroll = () => {
    const sectionTop = sectionOffsetTop - virtualScroll;

    if (isMobile && virtualScroll < 80) {
      cardInner.style.transform = 'rotateY(0deg)';
      smallCards.style.opacity = '0';
      smallCards.style.transform = 'translateY(-200px)';
      return;
    }

    const startThreshold = isMobile ? viewportHeight * 0.8 : viewportHeight * 0.35;
    const endThreshold   = isMobile ? -viewportHeight * 0.4 : -viewportHeight * 0.45;

    if (sectionTop > startThreshold) {
      cardInner.style.transform = 'rotateY(0deg)';
      smallCards.style.opacity = '0';
      smallCards.style.transform = 'translateY(-200px)';
      return;
    }

    const scrolledAmount = startThreshold - sectionTop;
    const scrollRange    = startThreshold - endThreshold;

    const base = clamp01(scrolledAmount / scrollRange);
    let rawProgress;

    if (isMobile) {
      const delayed = (base - 0.25) / 0.75;
      rawProgress = clamp01(delayed);
    } else {
      rawProgress = base;
    }

    const scrollProgress = easeInOutCubic(rawProgress);

    let flipProgress;
    if (isMobile) {
      flipProgress = scrollProgress;
    } else {
      flipProgress = clamp01((scrollProgress - 0.15) / 0.55);
    }

    const flipAngle = flipProgress * 180;
    cardInner.style.transform = `rotateY(${flipAngle}deg)`;

    const cardsStart   = scrollRange * 0.6;
    const cardsEnd     = scrollRange * 1.4;
    const cardsRaw     = (scrolledAmount - cardsStart) / (cardsEnd - cardsStart);
    const cardsClamped = clamp01(cardsRaw);
    const easedCards   = easeInOutCubic(cardsClamped);
    const cardsY       = 200 - easedCards * 200;
    const cardsOpacity = easedCards;
    smallCards.style.opacity = String(cardsOpacity);
    smallCards.style.transform = `translateY(-${cardsY}px)`;
  };

  const animate = () => {
    const factor = isMobile ? 0.12 : 0.18;
    virtualScroll += (targetScroll - virtualScroll) * factor;
    updateWithScroll();
    requestAnimationFrame(animate);
  };

  window.addEventListener('scroll', () => {
    targetScroll = window.scrollY || window.pageYOffset || 0;
  }, { passive: true });

  cardInner.style.transition = 'none';
  smallCards.style.transition = 'none';

  requestAnimationFrame(animate);
});
</script>