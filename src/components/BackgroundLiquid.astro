<div id="liquid" aria-hidden="true">
  <canvas id="layer0"></canvas>
  <canvas id="layer1"></canvas>
  <div class="veil"></div>
  <div class="vignette"></div>
</div>

<style>
#liquid{
  position:fixed;
  top: calc(-25vh - var(--safe-top));
  left: calc(-10vw - var(--safe-left));
  right: calc(-10vw - var(--safe-right));
  bottom: calc(-25vh - var(--safe-bottom));
  z-index:1;
  pointer-events:none;
  background:
    radial-gradient(1400px 1000px at 12% -10%, #0b1526 0%, #0b1526 50%, transparent 70%),
    radial-gradient(1000px 800px at 88% 8%,  #132a46 0%, #132a46 30%, transparent 65%),
    linear-gradient(180deg,#0b1526 0%, #0a0f16 100%);
}
#layer0,#layer1{position:absolute;inset:0;width:100%;height:100%;display:block}
#layer0{filter:blur(30px)}
#layer1{filter:blur(25px)}
.veil{position:absolute;inset:0;background:rgba(10,15,22,.22)}
.vignette{position:absolute;inset:0;background:
  radial-gradient(120% 95% at 50% 42%, rgba(0,0,0,0) 56%, rgba(0,0,0,.45) 100%)}

@media (max-width:768px){
  #liquid{
    top: calc(-30vh - var(--safe-top));
    bottom: calc(-30vh - var(--safe-bottom));
  }
  #layer0{filter:blur(18px)}
  #layer1{filter:blur(15px)}
}

@media (orientation: landscape){
  #liquid{
    left: calc(-12vw - var(--safe-left));
    right: calc(-12vw - var(--safe-right));
  }
}

@media (prefers-reduced-motion:reduce){#layer0,#layer1{display:none}}
</style>

<script>
const c0=document.getElementById('layer0'), g0=c0.getContext('2d',{alpha:true,willReadFrequently:false});
const c1=document.getElementById('layer1'), g1=c1.getContext('2d',{alpha:true,willReadFrequently:false});
let W=0,H=0,PR=1,t0=0,run=true,rafId=null;

const isMobile=/iPhone|iPad|iPod|Android/i.test(navigator.userAgent)||window.innerWidth<768;
const fpsTarget=isMobile?20:30;

function resize(){
  const isIOS = /iPad|iPhone|iPod/.test(navigator.userAgent);
  const vv = window.visualViewport;
  PR = Math.min(devicePixelRatio || 1, isMobile ? 1 : 1.5);

  const baseW = vv ? vv.width : innerWidth;
  const baseH = vv ? vv.height : innerHeight;

  const wFactor = 1.3;
  const hFactor = isMobile ? 1.9 : 1.6;

  W = c0.width  = c1.width  = Math.floor(baseW * PR * wFactor);
  H = c0.height = c1.height = Math.floor(baseH * PR * hFactor);
}
resize();
let resizeTimeout;
let lastVVWidth = 0;
let lastVVHeight = 0;

addEventListener('resize',()=>{
  clearTimeout(resizeTimeout);
  resizeTimeout=setTimeout(()=>{
    const vv = window.visualViewport;
    const vvW = vv ? vv.width : innerWidth;
    const vvH = vv ? vv.height : innerHeight;
    
    if(Math.abs(vvW - lastVVWidth) > 50 || Math.abs(vvH - lastVVHeight) > 100){
      lastVVWidth = vvW;
      lastVVHeight = vvH;
      resize();
    }
  },200);
});

const mix=(a,b,t)=>a+(b-a)*t;
const osc=(t,k=1,ph=0)=>(Math.sin(t*k+ph)+1)/2;
const wiggle=(t,mag=1)=>Math.sin(t*1.7)*.6+Math.sin(t*2.3+1.2)*.4;

const BLOBS=[
  {col:[32,65,106], alpha:0.24, r:480, sp:.14, off:0.0, amp:.16},
  {col:[32,65,106], alpha:0.18, r:620, sp:.11, off:1.1, amp:.18},
  {col:[212,175,55],alpha:0.10, r:540, sp:.13, off:2.0, amp:.17}
];

const BEAMS=[
  {w:.18, hue1:216, hue2:192, a:.38, sp:.16, off:0.0, rot:.05},
  {w:.15, hue1:46,  hue2:28,  a:.32, sp:.14, off:0.9, rot:-.04},
  {w:.12, hue1:210, hue2:228, a:.28, sp:.18, off:1.8, rot:.03}
];

function drawMasses(t){
  g0.clearRect(0,0,W,H);
  g0.save();
  g0.globalCompositeOperation='screen';
  for(const b of BLOBS){
    const tt=t*b.sp+b.off;
    const jx=wiggle(tt*.9,b.amp), jy=wiggle(tt*1.1,b.amp);
    const x=mix(W*0.10,W*0.90, osc(tt,0.7,0.3)) + jx*50;
    const y=mix(H*0.06,H*0.92, osc(tt,1.2,1.1)) + jy*40;
    const R=b.r*mix(0.95,1.2,osc(tt,0.8,0.6));
    const grad=g0.createRadialGradient(x,y,0,x,y,R);
    grad.addColorStop(0,`rgba(${b.col[0]},${b.col[1]},${b.col[2]},${b.alpha})`);
    grad.addColorStop(1,`rgba(${b.col[0]},${b.col[1]},${b.col[2]},0)`);
    g0.fillStyle=grad;
    g0.beginPath(); g0.arc(x,y,R,0,Math.PI*2); g0.fill();
  }
  g0.globalCompositeOperation='soft-light';
  g0.fillStyle='rgba(32,65,106,0.08)'; g0.fillRect(0,0,W,H);
  g0.restore();
}

function drawBeams(t){
  g1.clearRect(0,0,W,H);
  g1.save();
  g1.globalCompositeOperation='screen';

  for(const b of BEAMS){
    const p=t*b.sp+b.off;
    const y1=H*mix(0.12,0.42,osc(p,0.8,0.2)) + wiggle(p*1.2,.6)*18;
    const y2=H*mix(0.60,0.90,osc(p,1.25,1.1)) + wiggle(p*1.1,.6)*18;
    const cx=W*mix(0.16,0.84,osc(p,0.7,0.7)) + wiggle(p,.8)*30;
    const thick=Math.max(W,H)*b.w;

    g1.save();
    const ang=wiggle(p,.5)*b.rot;
    g1.translate(W*.5,H*.5);
    g1.rotate(ang);
    g1.translate(-W*.5,-H*.5);

    const grad=g1.createLinearGradient(0,y1,W,y2);
    grad.addColorStop(0,`hsla(${b.hue1} 72% 62% / ${b.a})`);
    grad.addColorStop(1,`hsla(${b.hue2} 76% 66% / ${b.a*.85})`);

    g1.strokeStyle=grad;
    g1.lineCap='round';
    g1.lineWidth=thick;

    g1.beginPath();
    g1.moveTo(-W*0.12,y1);
    g1.quadraticCurveTo(cx,H*mix(0.22,0.78,osc(p,1.4,0.4)),W*1.12,y2);
    g1.stroke();

    g1.globalAlpha=.5;
    g1.lineWidth=thick*.4;
    g1.stroke();
    g1.restore();
  }

  const glow=g1.createRadialGradient(W*.5,H*.98,0,W*.5,H, W*.6);
  glow.addColorStop(0,'rgba(140,190,240,.18)');
  glow.addColorStop(1,'rgba(0,0,0,0)');
  g1.fillStyle=glow; g1.fillRect(0,0,W,H);

  g1.restore();
}

let lastFrame=0;
const FRAME_INTERVAL=1000/fpsTarget;

function frame(ts){
  if(!t0) t0=ts;
  if(!run) return;
  
  const delta=ts-lastFrame;
  if(delta<FRAME_INTERVAL){
    rafId=requestAnimationFrame(frame);
    return;
  }
  lastFrame=ts-(delta%FRAME_INTERVAL);
  
  const t=(ts-t0)/1000;
  drawMasses(t*1.15);
  drawBeams(t*1.25);
  rafId=requestAnimationFrame(frame);
}

document.addEventListener('visibilitychange',()=>{
  run=!document.hidden;
  if(run) rafId=requestAnimationFrame(frame);
  else if(rafId) cancelAnimationFrame(rafId);
});

rafId=requestAnimationFrame(frame);
</script>